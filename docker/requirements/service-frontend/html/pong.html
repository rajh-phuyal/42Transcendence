<!DOCTYPE html>
<html>
<head>
    <title>Pong Game</title>
    <link rel="stylesheet" href="../css/styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <style>
        .paragraph {
            font-family: Arial, sans-serif;
            font-size: 24px;
            color: #FF0000;
            height: 10vh;
            font-style: normal;
            text-align: center;
        }
        .game {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 80vh;
        }
        #gameContainer {
			display: flex;
            justify-content: center;
            align-items: center;
        }
    </style>
</head>
<body>
    <h1>Barely Alive Pong 2.0</h1>
    <div class="game">
        <div id="gameContainer"></div>
    </div>
    <script>
        let player1Y, player2Y, player1Score, player2Score, ball, gameStarted, t;
        let upPressed = false;
        let downPressed = false;
        const PAUSE_TIME = 60;
        const PLAYER_MOVE_SPEED = 5;
        const BALL_SPEED = PLAYER_MOVE_SPEED * 1.5;
        const PADDLE_HEIGHT = 100;
        const PADDLE_WIDTH = 20;

        function setup() {
            let canvas = createCanvas(800, 600); // Set the size of the canvas
            canvas.parent('gameContainer'); // Ensure the canvas is within the #gameContainer div
            angleMode(DEGREES);
            player1Y = height / 2;
            player2Y = height / 2;
            player1Score = 0;
            player2Score = 0;
            gameStarted = false;
            t = 0;
            ball = new Ball(createVector(width / 2, height / 2));
        }

        function draw() {
            background(0);
            updatePlayer2();
            drawPlayers();
            drawScores();
            stroke(255);
            line(width / 2, 0, width / 2, height);

            ball.draw();

            if (!gameStarted) {
                t++;
                if (t >= PAUSE_TIME) {
                    t = 0;
                    gameStarted = true;
                }
                return;
            }

            ball.update();

            if (upPressed) {
                movePlayerUp();
            }
            if (downPressed) {
                movePlayerDown();
            }
        }

        class Ball {
            constructor(position, speed = BALL_SPEED) {
                this.position = position;
                this.speed = speed;
                this.radius = 12;
                this.resetVelocity();
            }

			resetVelocity() {
				// randomize theta until it's not between 45 and 135 nor between 225 and 315
				while (true) {
					this.theta = random(0, 360);
					if (!((this.theta >= 45 && this.theta <= 135) || (this.theta >= 225 && this.theta <= 315))) {
						break;
					}
				}
				this.velocity = createVector(
					this.speed * cos(this.theta), -this.speed * sin(this.theta)
				);
				player2Y = height / 2;
			}


            draw() {
                fill(255);
                noStroke();
                ellipse(this.position.x, this.position.y, this.radius * 2, this.radius * 2);
            }

            collideWithPaddle(x, y) {
                if (this.position.x - this.radius < x + PADDLE_WIDTH / 2 &&
                    this.position.x + this.radius > x - PADDLE_WIDTH / 2) {
                    if (dist(0, this.position.y, 0, y) <
                        PADDLE_HEIGHT / 2 + this.radius) {
                        if (this.position.x > x) {
                            this.position.x = x + this.radius + PADDLE_WIDTH / 2;
                        } else if (this.position.x < x) {
                            this.position.x = x - this.radius - PADDLE_WIDTH / 2;
                        }
                        this.velocity.x *= -1;
                    }
                }
            }

            update() {
                // Handle wall collisions
                if (this.position.x < 0) {
                    player2Score++;
                    this.position = createVector(width / 2, height / 2);
                    gameStarted = false;
                    this.resetVelocity();
                } else if (this.position.x > width) {
                    player1Score++;
                    this.position = createVector(width / 2, height / 2);
                    gameStarted = false;
                    this.resetVelocity();
                }
                if (this.position.y < 0) {
                    this.position.y = 0;
                    this.velocity.y *= -1;
                } else if (this.position.y > height) {
                    this.position.y = height;
                    this.velocity.y *= -1;
                }

                // Handle paddle collisions
                this.collideWithPaddle(20, player1Y);
                this.collideWithPaddle(width - 20, player2Y);

                this.position.add(this.velocity);
            }
        }

        function drawScores() {
            fill(255);
            textSize(20);

            let s = "Player 1: " + player1Score;
            text(s, width * 0.25 - textWidth(s) / 2, 25);
            s = "Player 2: " + player2Score;
            text(s, width * 0.75 - textWidth(s) / 2, 25);
        }

        function updatePlayer2() {
            if (abs(player2Y - ball.position.y) < PLAYER_MOVE_SPEED) {
                player2Y = ball.position.y;
            } else if (player2Y - ball.position.y >= PLAYER_MOVE_SPEED) {
                player2Y -= PLAYER_MOVE_SPEED;
            } else if (player2Y - ball.position.y <= PLAYER_MOVE_SPEED) {
                player2Y += PLAYER_MOVE_SPEED;
            }
        }

        function keyPressed() {
            if (keyCode === UP_ARROW) {
                upPressed = true;
            } else if (keyCode === DOWN_ARROW) {
                downPressed = true;
            }
        }

        function keyReleased() {
            if (keyCode === UP_ARROW) {
                upPressed = false;
            } else if (keyCode === DOWN_ARROW) {
                downPressed = false;
            }
        }

        function movePlayerUp() {
            player1Y = max(player1Y - PLAYER_MOVE_SPEED, PADDLE_HEIGHT / 2);
        }

        function movePlayerDown() {
            player1Y = min(player1Y + PLAYER_MOVE_SPEED, height - PADDLE_HEIGHT / 2);
        }

        function drawPlayers() {
            // Constrain the player movement
            player1Y = constrain(player1Y, PADDLE_HEIGHT / 2, height - PADDLE_HEIGHT / 2);
            player2Y = constrain(player2Y, PADDLE_HEIGHT / 2, height - PADDLE_HEIGHT / 2);

            rectMode(CENTER);
            fill(255);
            rect(20, player1Y, PADDLE_WIDTH, PADDLE_HEIGHT);
            rect(width - 20, player2Y, PADDLE_WIDTH, PADDLE_HEIGHT);
        }
    </script>
</body>
</html>
